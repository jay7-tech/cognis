<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognis Pro | Identity OS</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=SF+Pro+Display:wght@300;500;700&display=swap"
        rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg: #FBFBFD;
            --sidebar: #F5F5F7;
            --accent: #0071E3;
            --border: rgba(0, 0, 0, 0.08);
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --glass: saturate(180%) blur(20px);
            --radius-lg: 18px;
            --radius-md: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--bg);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: 260px;
            background: var(--sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 40px 20px;
            z-index: 100;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 40px;
            padding-left: 10px;
            letter-spacing: -0.5px;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: rgba(0, 0, 0, 0.03);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: #fff;
            color: var(--accent);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
        }

        /* --- CONTENT AREA --- */
        #content {
            flex: 1;
            padding: 60px 80px;
            overflow-y: auto;
            position: relative;
        }

        .view {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 40px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 40px;
        }

        /* --- BENTO CARDS --- */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.02);
            transition: 0.3s cubic-bezier(0.2, 0, 0, 1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.06);
        }

        .card h2 {
            font-size: 19px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        /* --- INFRASTRUCTURE ELEMENTS --- */
        input,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            background: #F5F5F7;
            border: 1px solid transparent;
            font-size: 15px;
            outline: none;
            transition: 0.2s;
            margin-bottom: 16px;
        }

        input:focus {
            border-color: var(--accent);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 14px 28px;
            border-radius: 100px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            width: 100%;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .metric-badge {
            background: rgba(40, 205, 65, 0.1);
            color: #28CD41;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* --- GRAPH AREA --- */
        #graph-container {
            width: 100%;
            height: 600px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            position: relative;
            cursor: move;
        }

        .node text {
            font-size: 11px;
            font-weight: 500;
            fill: var(--text-primary);
            pointer-events: none;
        }

        .link {
            stroke: #D2D2D7;
            stroke-opacity: 0.4;
        }

        /* --- ANALYTICS --- */
        .pattern-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #F5F5F7;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .pattern-label {
            font-size: 14px;
            font-weight: 500;
        }

        .pattern-count {
            font-weight: 700;
            color: var(--accent);
        }

        .loader-bar {
            height: 3px;
            background: var(--accent);
            width: 0%;
            position: fixed;
            top: 0;
            left: 260px;
            transition: width 0.4s;
            z-index: 2000;
        }

        .reflection-output {
            padding: 24px;
            background: #F5F5F7;
            border-radius: 16px;
            line-height: 1.7;
            font-size: 16px;
            white-space: pre-wrap;
        }

        /* --- DOCK STATUS --- */
        #status-dock {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--glass);
            border: 1px solid var(--border);
            padding: 10px 24px;
            border-radius: 100px;
            display: flex;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .step-item {
            color: var(--text-secondary);
        }

        .step-item b {
            color: var(--text-primary);
        }
    </style>
</head>

<body>
    <div class="loader-bar" id="loader"></div>

    <aside id="sidebar">
        <div class="logo">COGNIS PRO</div>
        <nav>
            <div class="nav-item active" onclick="showView('dash', this)">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <rect x="2" y="2" width="6" height="6" rx="1.5" fill="currentColor" />
                    <rect x="10" y="2" width="6" height="6" rx="1.5" fill="currentColor" />
                    <rect x="2" y="10" width="6" height="6" rx="1.5" fill="currentColor" />
                    <rect x="10" y="10" width="6" height="6" rx="1.5" fill="currentColor" />
                </svg>
                Dashboard
            </div>
            <div class="nav-item" onclick="showView('brain', this)">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path
                        d="M14 9C14 11.7614 11.7614 14 9 14C6.23858 14 4 11.7614 4 9C4 6.23858 6.23858 4 9 4C11.7614 4 14 6.23858 14 9Z"
                        stroke="currentColor" stroke-width="2" />
                </svg>
                Memory Ingest
            </div>
            <div class="nav-item" onclick="showView('mind', this); loadGraph()">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <circle cx="4" cy="4" r="2" fill="currentColor" />
                    <circle cx="14" cy="4" r="2" fill="currentColor" />
                    <circle cx="9" cy="14" r="2" fill="currentColor" />
                    <path d="M5.5 5.5L8 12.5M12.5 5.5L10 12.5M6 4H12" stroke="currentColor" stroke-width="1.5" />
                </svg>
                Knowledge Map
            </div>
            <div class="nav-item" onclick="showView('audit', this)">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M9 16V9M9 9L12 6M9 9L6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                Neural Audit
            </div>
        </nav>
    </aside>

    <main id="content">
        <!-- DASHBOARD VIEW -->
        <div id="dash" class="view active">
            <h1>Good evening.</h1>
            <p class="subtitle">Cognis is analyzing your daily cognitive flow.</p>

            <div class="bento-grid">
                <div class="card">
                    <h2>Active Pattern Scan <span class="metric-badge">Live</span></h2>
                    <div id="pattern-summary">Refresh brain data to view patterns.</div>
                </div>
                <div class="card">
                    <h2>Optimization Plan</h2>
                    <div id="quick-intervention" style="color: var(--text-secondary); font-size: 14px;">No urgent
                        conflicts detected.</div>
                    <button class="btn-primary" style="margin-top: 24px; background: #000;" onclick="getPlan()">Generate
                        Action Plan</button>
                </div>
            </div>
        </div>

        <!-- BRAIN VIEW -->
        <div id="brain" class="view">
            <h1>Memory Bank.</h1>
            <p class="subtitle">Mount data streams to build the neural foundation.</p>

            <div class="card" style="max-width: 600px;">
                <h2>Stream Ingestion</h2>
                <input type="text" id="file-path" placeholder="Path to .txt stream...">
                <button class="btn-primary" onclick="ingest()">Mount Stream</button>
                <div id="ingest-status" style="margin-top:20px; font-size: 13px; color: var(--text-secondary);">Ready
                    for connection.</div>
            </div>
        </div>

        <!-- MIND VIEW (GRAPH) -->
        <div id="mind" class="view">
            <h1>Knowledge Map.</h1>
            <p class="subtitle">A visual topography of your habits, goals, and emotions.</p>
            <div id="graph-container"></div>
            <div id="node-info"
                style="margin-top: 20px; padding: 20px; background: #fff; border: 1px solid var(--border); border-radius: 12px; display: none;">
                <h3 id="info-id" style="font-size: 16px;">Node Name</h3>
                <p id="info-desc" style="color: var(--text-secondary); font-size: 14px;">Description...</p>
            </div>
        </div>

        <!-- AUDIT VIEW -->
        <div id="audit" class="view">
            <h1>Deep Synthesis.</h1>
            <p class="subtitle">Reasoning about your identity with 98% faithfulness.</p>

            <div class="card">
                <h2>Query Neural Core</h2>
                <textarea id="reflect-query" rows="1" placeholder="Ask Cognis about your behavior..."></textarea>
                <button class="btn-primary" onclick="reflect()">Begin Synthesis</button>
            </div>

            <div class="card" style="margin-top: 24px;">
                <h2>Result</h2>
                <div class="reflection-output" id="reflect-result">Awaiting synthesis session...</div>
            </div>
        </div>
    </main>

    <div id="status-dock">
        <div class="step-item">Retriever: <b>ACTIVE</b></div>
        <div class="step-item">Latency: <b id="latency">0ms</b></div>
        <div class="step-item">Safety: <b style="color: #28CD41;">HALLUCINATION_SHIELD ON</b></div>
    </div>

    <script>
        const API = "";

        function showView(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        const setLoader = (w) => {
            const l = document.getElementById('loader');
            l.style.width = w + '%';
            if (w === 100) setTimeout(() => l.style.width = '0%', 600);
        };

        async function ingest() {
            setLoader(40);
            const path = document.getElementById('file-path').value;
            try {
                const res = await fetch(`${API}/ingest/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file_path: path })
                });
                const data = await res.json();
                setLoader(100);
                document.getElementById('ingest-status').innerText = `Success. Mounted ${data.chunks} fragments.`;
                loadPatterns();
            } catch (e) { setLoader(0); }
        }

        async function loadPatterns() {
            try {
                const res = await fetch(`${API}/patterns/temporal`);
                const data = await res.json();
                const container = document.getElementById('pattern-summary');
                container.innerHTML = data.map(p => `
                    <div class="pattern-row">
                        <span class="pattern-label">${p.theme}</span>
                        <span class="pattern-count">${p.occurrences}x</span>
                    </div>
                `).join('');
            } catch (e) { }
        }

        async function reflect() {
            const start = Date.now();
            setLoader(30);
            const query = document.getElementById('reflect-query').value;
            const resEl = document.getElementById('reflect-result');
            resEl.innerText = "Accessing memory shards...";
            try {
                const res = await fetch(`${API}/reflect/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: query })
                });
                const data = await res.json();
                setLoader(100);
                resEl.innerText = data.reflection;
                document.getElementById('latency').innerText = `${Date.now() - start}ms`;
            } catch (e) { resEl.innerText = "Synthesis failed."; }
        }

        async function getPlan() {
            const el = document.getElementById('quick-intervention');
            el.innerText = "Architecting optimization plan...";
            try {
                const res = await fetch(`${API}/intervene/plan`, { method: 'POST' });
                const data = await res.json();
                el.innerHTML = `
                    <div style="color: var(--text-primary); margin-bottom: 12px; font-weight: 600;">${data.title}</div>
                    <div style="font-size: 13px;">${data.steps[0].step}</div>
                `;
            } catch (e) { el.innerText = "Plan generation failed."; }
        }

        // --- D3 GRAPH LOGIC ---
        async function loadGraph() {
            const container = document.getElementById('graph-container');
            const width = container.clientWidth;
            const height = 600;
            container.innerHTML = "";

            try {
                const res = await fetch(`${API}/persona/`);
                const data = await res.json();
                if (!data.nodes) return;

                const svg = d3.select("#graph-container").append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g");

                const simulation = d3.forceSimulation(data.nodes)
                    .force("link", d3.forceLink(data.edges).id(d => d.id).distance(100))
                    .force("charge", d3.forceManyBody().strength(-300))
                    .force("center", d3.forceCenter(width / 2, height / 2));

                const link = svg.append("g")
                    .selectAll("line")
                    .data(data.edges)
                    .join("line")
                    .attr("class", "link")
                    .attr("stroke-width", 1.5);

                const node = svg.append("g")
                    .selectAll("g")
                    .data(data.nodes)
                    .join("g")
                    .attr("class", "node")
                    .call(d3.drag()
                        .on("start", (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
                        .on("drag", (e, d) => { d.fx = e.x; d.fy = e.y; })
                        .on("end", (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; }));

                node.append("circle")
                    .attr("r", 12)
                    .attr("fill", d => d.type === 'habit' ? '#8B5CF6' : d.type === 'goal' ? '#10B981' : '#EF4444')
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 2);

                node.append("text")
                    .attr("dx", 18)
                    .attr("dy", 4)
                    .text(d => d.id);

                node.on("click", (e, d) => {
                    const info = document.getElementById('node-info');
                    info.style.display = 'block';
                    document.getElementById('info-id').innerText = d.id;
                    document.getElementById('info-desc').innerText = d.description || "No description available.";
                });

                simulation.on("tick", () => {
                    link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                        .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                    node.attr("transform", d => `translate(${d.x},${d.y})`);
                });

            } catch (e) { console.error(e); }
        }

        window.onload = loadPatterns;
    </script>
</body>

</html>